function filtragrid(){document.getElementById("rompeQuery").style.display="";var nombre=document.getElementById("nombrenina").value;isNaN(nombre)?(nombre=nombre.toUpperCase(),""==document.getElementById("nombrenina").value&&grid.filter({nombrequinceanera:"*"},!0),document.getElementById("nombrenina").value.indexOf("correo")>-1?(nombre=nombre.substr(document.getElementById("nombrenina").value.indexOf(":")+1,document.getElementById("nombrenina").value.length),grid.filter({email:"*"+nombre+"*"},!0)):document.getElementById("nombrenina").value.indexOf("colegio")>-1?(nombre=nombre.substr(document.getElementById("nombrenina").value.indexOf(":")+1,document.getElementById("nombrenina").value.length),grid.filter({colegio:"*"+nombre+"*"},!0)):""!=document.getElementById("nombrenina").value&&(nombre=nombre.toUpperCase(),grid.filter({nombrequinceanera:"*"+nombre+"*"},!0))):""==document.getElementById("nombrenina").value?grid.filter({id:"*"},!0):grid.filter({id:"*"+nombre+"*"},!0)}function filtraSeguimiento(id){document.getElementById("rompeQuery").style.display="",grid.filter({id:id},!0)}function cargaTodos(){document.getElementById("rompeQuery").style.display="none",grid.selection.deselectAll(),grid.filter({id:"*"},!0),document.getElementById("idagencia").value="",document.getElementById("idusers").value="",document.getElementById("iddestino").value="",document.getElementById("nombrenina").value=""}function borraNotificacion(id){return!!confirm("¿Desea eliminar esa notificación?")&&void require(["dojo/_base/xhr"],function(xhr){xhr.get({url:"../../../v15/mariposa/seguimientos/borrarNotificacion?idseguimiento="+id,load:function(result){seguimientoactualizar=window.parent.inscripcionAlmacen.get(id),seguimientoactualizar.transferencia="0",seguimientoactualizar.vinculacion="0",seguimientoactualizar.tracker="0",seguimientoactualizar.bitacora="0",window.parent.inscripcionAlmacen.put(seguimientoactualizar),window.parent.inscripcion=window.parent.inscripcionAlmacen.data,crearNotificaciones(),grid.filter({agente:window.parent.nombreuseract.toUpperCase()})}})})}function crearNotificaciones(){contadornoti=0,interna="";var fecha=new Date,fechaRegistro=0,fechaRegistro2=0,actualMayorIngreso=!1;for(mes=fecha.getMonth()+1,dia=fecha.getDate(),mes<10&&(mes="0"+mes),dia<10&&(dia="0"+dia),fechaactual=parseInt(fecha.getFullYear())+parseInt(100*mes)+parseInt(dia),list=document.getElementById("noti");list.hasChildNodes();)list.removeChild(list.firstChild);document.getElementById("noti").innerHTML="",nombreuser=window.parent.nombreuseract.toUpperCase(),interna="",window.parent.inscripcionAlmacen.query({nombreAgente:nombreuser},{sort:[{attribute:"fechaingreso",descending:!0}]}).forEach(function(shoe){fechaRegistro=shoe.fechaingreso.replace(/-/gi,","),fechaRegistro2=fechaRegistro;var arrayFechaRegistro=fechaRegistro.split(",");if(mes=arrayFechaRegistro[1],dia=arrayFechaRegistro[2],fechaRegistro=parseInt(arrayFechaRegistro[0])+parseInt(100*mes)+parseInt(dia),fechaactual>fechaRegistro&&(actualMayorIngreso=!0),0!=shoe.transferencia||0!=shoe.vinculacion||0!=shoe.bitacora){var id=shoe.id;interna+='<div style="width:95%; background-color:#DDDDDD; border:solid 1px;#888888;position:relative;-moz-border-radius: 5px;border-radius: 5px; font-family:Verdana, Geneva, sans-serif; font-size:12px; margin-bottom:5px;"><div style="width:100%; height:21px;color:#444444; text-align:left" ><div style="float:left; width:49%">Seguimiento:<strong>'+shoe.id+'</strong></div><div style="float:right;width:49%; text-align:right"><img src="imgs/cerrar.png" border="0" onclick="borraNotificacion('+id+');" onMouseOver="document.body.style.cursor = \'pointer\';" onMouseOut="document.body.style.cursor = \'default\';"/></div></div><div style="width:100%; color:#A66BD6;font-size:12px; text-align:left; padding-left:0.5em; ">'+shoe.nombrequinceanera+'</div><div onClick="filtraSeguimiento('+id+');" onMouseOver="document.body.style.cursor = \'pointer\';" onMouseOut="document.body.style.cursor = \'default\';"><div style="width:100%; color:#A66BD6;font-size:12px; text-align:center"><ul style="margin-left:-10px">';var id=shoe.id,nombre="";window.parent.bitacora2Almacen.query({idseguimiento:id}).forEach(function(bita){nombre=bita.nombreUsuario}),0!=shoe.transferencia&&(interna+='<li><div align="left" style="color:#B71BB7; ">Transferido por otro usuario.</div></li>'),0!=shoe.vinculacion&&(interna+="Vinculado a otro seguimiento.<br/>"),0!=shoe.bitacora&&(interna+='<li><div align="left" style="color:#B71BB7; ">Nuevo Mensaje en bitacora de: <br /><strong>'+nombre+"</strong></div></li>"),interna+="</ul></div></div></div>",contadornoti++}}),document.getElementById("noti").innerHTML+=interna,document.getElementById("totalnoti").innerHTML=contadornoti}function cuadraIngresos(){alert("entra"),ancho=screen.width,alert(ancho),areafinal=79*ancho/100,alert(areafinal)}function iniciaGrid(){cargaTodos();var d=new Date,year=d.getFullYear(),month=d.getMonth()+1,monthQuery="06";month>=6&&(monthQuery="12");var filterObject={};filterObject.nombreAgente=window.parent.nombreuseract.toUpperCase(),filterObject.mesviaje_quinceanera=monthQuery,filterObject.anoviaje_quinceanera=year,filterObject.estado="1",document.getElementById("rompeQuery").style.display="",grid.filter(filterObject,!0)}dojo.require("dojox.grid.DataGrid"),dojo.require("dojo.data.ItemFileWriteStore"),dojo.require("dijit.Tooltip"),dojo.require("dojo.date.stamp"),dojo.require("dojo.date.locale"),dojo.require("dojo.data.ItemFileReadStore");var agencias=window.parent.agencia,users=window.parent.todos,contadornoti=0,nombretemp,color="vacio",nombregrid="vacio",contadornoti=0,interna;dojo.ready(function(){function poneDestino(destino,rowIndex){var NombreDestino="";return prueba=parseInt(destino),isNaN(prueba)?NombreDestino=destino:(window.parent.DestinosAlmacen.query({id:destino}).forEach(function(des){nombre=des.sigla}),NombreDestino=nombre),'<font style="color:#656565; font-size:0.7em">'+NombreDestino+"</font>"}function poneSalida(salida,rowIndex){return salida?'<font style="color:#656565; font-size:0.9em">'+salida+"</font>":'<font style="color:#656565; font-size:0.9em"></font>'}function poneMes(salida,rowIndex){switch(fechatotal="",salida){case"01":fechatotal+="ENE";break;case"02":fechatotal+="FEB";break;case"03":fechatotal+="MAR";break;case"04":fechatotal+="ABR";break;case"05":fechatotal+="MAY";break;case"06":fechatotal+="JUN";break;case"07":fechatotal+="JUL";break;case"08":fechatotal+="AGO";break;case"09":fechatotal+="SEP";break;case"10":fechatotal+="OCT";break;case"11":fechatotal+="NOV";break;case"12":fechatotal+="DIC"}return'<font style="color:#656565; font-size:0.9em">'+fechatotal+"</font>"}function poneCiudad(ciudad,rowIndex){return prueba=parseInt(ciudad),isNaN(prueba)?nombreCiudad=ciudad:window.parent.CuidadesAlmacen.query({id:ciudad}).forEach(function(des){nombreCiudad=des.name}),'<font style="color:#656565; font-size:0.9em">'+nombreCiudad+"</font>"}function cuadraNombre(nombrequinceanera,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+nombrequinceanera+"</font>"}function setVendedor(agente,rowIndex){return prueba=parseInt(agente),isNaN(prueba)?nombreCiudad=agente:window.parent.UsuariosAlmacen.query({id:agente}).forEach(function(des){nombreCiudad=des.nombre}),'<font style="color:#656565; font-size:0.9em">'+nombreCiudad+"</font>"}function setFecha(fechaingreso,rowIndex){var fechatotal="NA";if(fechaingreso){var displayPattern="d-MMM-yyyy",d=dojo.date.stamp.fromISOString(fechaingreso);fechatotal=dojo.date.locale.format(d,{selector:"date",datePattern:displayPattern})}return'<font style="color:#656565; font-size:0.9em">'+fechatotal+"</font>"}function setContacto(nombrequienllama,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+nombrequienllama+"</font>"}function setId(id,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+id+"</font>"}for(var data={identifier:"id",items:[]},data_list=[{col1:"normal",col2:!0,col3:"But are not followed by two hexadecimal",col4:29.91},{col1:"important",col2:!1,col3:"Because a % sign always indicates",col4:9.33},{col1:"important",col2:!0,col3:"Signs can be selectively",col4:19.34}],rows=60,i=0,l=data_list.length;i<rows;i++)data.items.push(dojo.mixin({id:i+1},data_list[i%l]));new dojo.data.ItemFileWriteStore({data:data});grid=new dojox.grid.DataGrid({id:"grid",query:{agente:window.parent.nombreuseract.toUpperCase()},store:window.parent.inscripcionStore,clientSort:!0,onRowClick:function(e){id=grid._getItemAttr(e.rowIndex,"id"),whatIs="Ins",window.parent.crearinscripcion(id,whatIs),grid.selection.deselectAll(),grid.selection.setSelected(e.rowIndex,!0)},structure:[{name:"Seg",field:"id",width:"10%",width:"2.5em",formatter:setId},{name:"#",field:"inscrita",formatter:poneSalida,width:"2.5em"},{name:"Inscrita El",field:"fechaingreso",width:"6.5em",formatter:setFecha},{name:"Quincea&ntilde;era",field:"nombrequinceanera",width:"15em",formatter:cuadraNombre},{name:"Destino",field:"iddestino",width:"15em",formatter:poneDestino,width:"4em"},{name:"Año",field:"anoviaje_quinceanera",width:"3em",formatter:poneSalida},{name:"Mes",field:"mesviaje_quinceanera",width:"2em",formatter:poneMes},{name:"Quien Inscribio A La Niña",field:"nombrequienllama",width:"15em",formatter:setContacto},{name:"Vendedor",field:"nombreAgente",width:"15em",formatter:setVendedor,width:"11.5em"},{name:"Asesor",field:"asesorNombre",width:"15em",formatter:setVendedor,width:"11.5em"},{name:"Ciudad",field:"ciudadResidencia",width:"7.5em",formatter:poneCiudad}]},"gridDiv"),grid.startup(),dojo.connect(grid,"_onFetchComplete",function(items){dojo.byId("totalseg").innerHTML=grid.rowCount}),tamano=window.parent.tama-150,document.getElementById("grid").style.height=tamano+"px",dijit.byId("grid").resize(),dijit.byId("grid").update(),document.getElementById("rompeQuery").style.display=""}),require(["dojo/ready","dojo/store/Memory","dijit/form/ComboBox","dijit/form/ValidationTextBox","dijit/form/FilteringSelect"],function(ready,Memory,ComboBox,ValidationTextBox,FilteringSelect){ready(function(){var yearStore=new Memory({data:[{name:"2012"},{name:"2013"},{name:"2014"},{name:"2015"},{name:"2016"},{name:"2017"},{name:"2018"},{name:"2019"},{name:"2020"}]});medio=new dijit.form.ComboBox({id:"idagencia",name:"data[Agencia][Agencia]",placeHolder:"Mes",require:!1,store:new Memory({data:[{mesviaje_quinceanera:"JUNIO",value:"06"},{mesviaje_quinceanera:"DICIEMBRE",value:"12"}]}),autoComplete:!0,style:"width: 120px;color:#F00;backgorund-color:#ECE3F9;font-family:Verdana, Geneva, sans-serif;",onChange:function(departamento){document.getElementById("rompeQuery").style.display="",grid.filter({mesviaje_quinceanera:this.item.value},!0)},searchAttr:"mesviaje_quinceanera"},"AgenciaAgencia"),destino=new dijit.form.FilteringSelect({id:"iddestino",name:"data[Destino][Destino]",placeHolder:"Destino",require:!1,store:new Memory({data:window.parent.destino}),autoComplete:!0,style:"width: 300px;color:#F00;backgorund-color:#ECE3F9;font-family:Verdana, Geneva, sans-serif;",onChange:function(departamento){document.getElementById("rompeQuery").style.display="",grid.filter({destino:this.item.sigla},!0)},searchAttr:"name"},"destinoSeguimiento"),vendedor=new dijit.form.ComboBox({id:"idusers",name:"data[Seguimientos][User]",require:!1,placeHolder:"Año",store:yearStore,autoComplete:!0,style:"width: 100px;color:#F00;backgorund-color:#ECE3F9;font-family:Verdana, Geneva, sans-serif;",onChange:function(agente){document.getElementById("rompeQuery").style.display="",grid.filter({anoviaje_quinceanera:this.item.name},!0)},searchAttr:"name"},"VendedorVendedor"),dijit.byId("idagencia").required=!1,dijit.byId("idusers").required=!1,crearNotificaciones(),document.getElementById("totalseg").innerHTML=window.parent.seguimiento.length})}),window.parent.grabar=0,carga=window.parent.grabar,0==carga;