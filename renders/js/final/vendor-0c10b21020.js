function filtragrid(){document.getElementById("rompeQuery").style.display="";var nombre=document.getElementById("nombrenina").value;isNaN(nombre)?(nombre=nombre.toUpperCase(),""==document.getElementById("nombrenina").value&&grid.filter({nombrequinceanera:"*",estado:document.getElementById("estado").value},!0),document.getElementById("nombrenina").value.indexOf("correo")>-1?(nombre=nombre.substr(document.getElementById("nombrenina").value.indexOf(":")+1,document.getElementById("nombrenina").value.length),grid.filter({email:"*"+nombre+"*"},!0)):document.getElementById("nombrenina").value.indexOf("colegio")>-1?(nombre=nombre.substr(document.getElementById("nombrenina").value.indexOf(":")+1,document.getElementById("nombrenina").value.length),grid.filter({colegio:"*"+nombre+"*"},!0)):""!=document.getElementById("nombrenina").value&&(nombre=nombre,grid.filter({nombrequinceanera:"*"+nombre+"*"},!0))):""==document.getElementById("nombrenina").value?grid.filter({id:"*"},!0):grid.filter({id:"*"+nombre.toUpperCase()+"*"},!0)}function filtraSeguimiento(id){document.getElementById("rompeQuery").style.display="",grid.filter({id:id},!0)}function cargaTodos(){document.getElementById("rompeQuery").style.display="none",grid.selection.deselectAll(),grid.filter({id:"*",estado:document.getElementById("estado").value},!0),document.getElementById("idagencia").value="",document.getElementById("idusers").value="",document.getElementById("iddestino").value="",document.getElementById("nombrenina").value=""}function borraNotificacion(id){return!!confirm("¿Desea eliminar esa notificación?")&&(console.log(id),void require(["dojo/_base/xhr"],function(xhr){xhr.get({url:"../../../v15/mariposa/seguimientos/borrarNotificacion?idseguimiento="+id,load:function(result){seguimientoactualizar=window.parent.seguimientoAlmacen.get(id),seguimientoactualizar.transferencia="0",seguimientoactualizar.vinculacion="0",seguimientoactualizar.tracker="0",seguimientoactualizar.bitacora="0",window.parent.seguimientoAlmacen.put(seguimientoactualizar),window.parent.segumiento=window.parent.seguimientoAlmacen.data,crearNotificaciones(),grid.filter({agente:window.parent.nombreuseract.toUpperCase()})}})}))}function crearNotificaciones(){contadornoti=0,interna="";var fecha=new Date,fechaRegistro=0,fechaRegistro2=0,actualMayorIngreso=!1;for(mes=fecha.getMonth()+1,dia=fecha.getDate(),mes<10&&(mes="0"+mes),dia<10&&(dia="0"+dia),fechaactual=parseInt(fecha.getFullYear())+parseInt(100*mes)+parseInt(dia),list=document.getElementById("noti");list.hasChildNodes();)list.removeChild(list.firstChild);document.getElementById("noti").innerHTML="",nombreuser=window.parent.nombreuseract.toUpperCase(),interna="",window.parent.seguimientoAlmacen.query({nombreAgente:nombreuser},{sort:[{attribute:"fechaingreso",descending:!0}]}).forEach(function(shoe){fechaRegistro=shoe.fechaingreso.replace(/-/gi,","),fechaRegistro2=fechaRegistro;var arrayFechaRegistro=fechaRegistro.split(",");if(mes=arrayFechaRegistro[1],dia=arrayFechaRegistro[2],fechaRegistro=parseInt(arrayFechaRegistro[0])+parseInt(100*mes)+parseInt(dia),fechaactual>fechaRegistro&&(actualMayorIngreso=!0),1==shoe.transferencia||1==shoe.vinculacion||1==shoe.bitacora){var id=shoe.id;interna+='<div style="width:95%; background-color:#DDDDDD; border:solid 1px;#888888;position:relative;-moz-border-radius: 5px;border-radius: 5px; font-family:Verdana, Geneva, sans-serif; font-size:12px; margin-bottom:5px;"><div style="width:100%; height:21px;color:#444444; text-align:left" ><div style="float:left; width:49%">Seguimiento:<strong>'+shoe.id+'</strong></div><div style="float:right;width:49%; text-align:right"><img src="imgs/cerrar.png" border="0" onclick="borraNotificacion('+id+');" onMouseOver="document.body.style.cursor = \'pointer\';" onMouseOut="document.body.style.cursor = \'default\';"/></div></div><div style="width:100%; color:#A66BD6;font-size:12px; text-align:left; padding-left:0.5em; ">'+shoe.nombrequinceanera+'</div><div onClick="filtraSeguimiento('+id+');" onMouseOver="document.body.style.cursor = \'pointer\';" onMouseOut="document.body.style.cursor = \'default\';"><div style="width:100%; color:#A66BD6;font-size:12px; text-align:center"><ul style="margin-left:-10px">';var id=shoe.id,nombre="";window.parent.bitacoraAlmacen.query({idseguimiento:id}).forEach(function(bita){nombre=bita.nombreUsuario}),0!=shoe.transferencia&&(interna+='<li><div align="left" style="color:#B71BB7; ">Transferido por otro usuario.</div></li>'),0!=shoe.vinculacion&&(interna+="Vinculado a otro seguimiento.<br/>"),0!=shoe.bitacora&&(interna+='<li><div align="left" style="color:#B71BB7; ">Nuevo Mensaje en bitacora de: <br /><strong>'+nombre+"</strong></div></li>"),interna+="</ul></div></div></div>",contadornoti++}}),document.getElementById("noti").innerHTML+=interna,document.getElementById("totalnoti").innerHTML=contadornoti}function cuadraIngresos(){alert("entra"),ancho=screen.width,alert(ancho),areafinal=79*ancho/100,alert(areafinal)}function filtraestado(){document.getElementById("rompeQuery").style.display="",estado=document.getElementById("estado").value,grid.filter({estado:estado},!0)}function iniciaGrid(){cargaTodos();var filterObject={};filterObject.nombreAgente=window.parent.nombreuseract.toUpperCase(),filterObject.estado=document.getElementById("estado").value,document.getElementById("rompeQuery").style.display="",grid.filter(filterObject,!0)}dojo.require("dojox.grid.DataGrid"),dojo.require("dojo.data.ItemFileWriteStore"),dojo.require("dijit.Tooltip"),dojo.require("dojo.date.stamp"),dojo.require("dojo.date.locale"),dojo.require("dojo.data.ItemFileReadStore");var agencias=window.parent.agencia,users=window.parent.todos,contadornoti=0,nombretemp,color="vacio",nombregrid="vacio",contadornoti=0,interna;dojo.ready(function(){function poneAgencia(agencia,rowIndex){return prueba=parseInt(agencia),isNaN(prueba)?nombreAgencia=agencia:window.parent.AgenciasAlmacen.query({id:agencia}).forEach(function(des){nombreAgencia=des.name}),'<font style="color:#656565; font-size:0.9em">'+nombreAgencia+"</font>"}function poneDestino(destinos,rowIndex){NombreDestino="",NumeroDestino="";for(var i=0;i<destinos.length;++i)"1"==destinos[i]&&(NombreDestino?(NombreDestino+="|CUR-AUA",NumeroDestino+="1,"):(NombreDestino="CUR-AUA",NumeroDestino="1,")),"2"==destinos[i]&&(NombreDestino?(NombreDestino+="|FLA",NumeroDestino+="2,"):(NombreDestino="FLA",NumeroDestino="2,")),"3"==destinos[i]&&(NombreDestino?(NombreDestino+="|EUR",NumeroDestino+="3,"):(NombreDestino="EUR",NumeroDestino="3,")),"4"==destinos[i]&&(NombreDestino?(NombreDestino+="|MEX",NumeroDestino+="4,"):(NombreDestino="MEX",NumeroDestino="4,")),"5"==destinos[i]&&(NombreDestino?(NombreDestino+="|FLA-CUN",NumeroDestino+="5,"):(NombreDestino="FLA-CUN",NumeroDestino="5,")),"6"==destinos[i]&&(NombreDestino?(NombreDestino+="|FLA-MQT",NumeroDestino+="6,"):(NombreDestino="FLA-MQT",NumeroDestino="6,")),"7"==destinos[i]&&(NombreDestino?(NombreDestino+="|SURA-VER",NumeroDestino+="7,"):(NombreDestino="SURA-VER",NumeroDestino="7,")),"8"==destinos[i]&&(NombreDestino?(NombreDestino+="|CXC",NumeroDestino+="8,"):(NombreDestino="CXC",NumeroDestino="8,")),"9"==destinos[i]&&(NombreDestino?(NombreDestino+="|PTY",NumeroDestino+="9,"):(NombreDestino="PTY",NumeroDestino="9,")),"10"==destinos[i]&&(NombreDestino?(NombreDestino+="|FLA-NY",NumeroDestino+="10,"):(NombreDestino="FLA-NY",NumeroDestino="10,")),"11"==destinos[i]&&(NombreDestino?(NombreDestino+="|NY-CUN",NumeroDestino+="11,"):(NombreDestino="NY-CUN",NumeroDestino="11,")),"12"==destinos[i]&&(NombreDestino?(NombreDestino+="|SURA-COMB-PER",NumeroDestino+="12,"):(NombreDestino="SURA-COMB-PER",NumeroDestino="12,")),"13"==destinos[i]&&(NombreDestino?(NombreDestino+="|HW",NumeroDestino+="13,"):(NombreDestino="HW",NumeroDestino="13,")),"14"==destinos[i]&&(NombreDestino?(NombreDestino+="|EUR2",NumeroDestino+="14,"):(NombreDestino="EUR2",NumeroDestino="14,")),"15"==destinos[i]&&(NombreDestino?(NombreDestino+="|ORM",NumeroDestino+="15,"):(NombreDestino="ORM",NumeroDestino="15,")),"16"==destinos[i]&&(NombreDestino?(NombreDestino+="|MIA_MCO",NumeroDestino+="16,"):(NombreDestino="MIA_MCO",NumeroDestino="16,")),"17"==destinos[i]&&(NombreDestino?(NombreDestino+="|NY9",NumeroDestino+="17,"):(NombreDestino="NY9",NumeroDestino="17,")),"18"==destinos[i]&&(NombreDestino?(NombreDestino+="|NYC_MIA",NumeroDestino+="18,"):(NombreDestino="NYC_MIA",NumeroDestino="18,")),"19"==destinos[i]&&(NombreDestino?(NombreDestino+="|DUBAI",NumeroDestino+="19,"):(NombreDestino="DUBAI",NumeroDestino="19,")),"20"==destinos[i]&&(NombreDestino?(NombreDestino+="|CUN6",NumeroDestino+="20,"):(NombreDestino="CUN6",NumeroDestino="20,"));return'<font style="color:#656565; font-size:0.7em">'+NombreDestino+"</font>"}function poneSalida(salida,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+salida+"</font>"}function poneMes(salida,rowIndex){switch(fechatotal="",salida){case"01":fechatotal+="ENE";break;case"02":fechatotal+="FEB";break;case"03":fechatotal+="MAR";break;case"04":fechatotal+="ABR";break;case"05":fechatotal+="MAY";break;case"06":fechatotal+="JUN";break;case"07":fechatotal+="JUL";break;case"08":fechatotal+="AGO";break;case"09":fechatotal+="SEP";break;case"10":fechatotal+="OCT";break;case"11":fechatotal+="NOV";break;case"12":fechatotal+="DIC"}return'<font style="color:#656565; font-size:0.9em">'+fechatotal+"</font>"}function poneCiudad(ciudad,rowIndex){return prueba=parseInt(ciudad),isNaN(prueba)?nombreCiudad=ciudad:window.parent.CuidadesAlmacen.query({id:ciudad}).forEach(function(des){nombreCiudad=des.name}),'<font style="color:#656565; font-size:0.9em">'+nombreCiudad+"</font>"}function cuadraNombre(nombrequinceanera,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+nombrequinceanera+"</font>"}function setVendedor(agente,rowIndex){var agenteNombre;return window.parent.UsuariosAlmacen.query({id:agente}).forEach(function(des){agenteNombre=des.nombre}),'<font style="color:#656565; font-size:0.9em">'+agenteNombre+"</font>"}function setFecha(fechaingreso,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+fechaingreso+"</font>"}function setContacto(nombrequienllama,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+nombrequienllama+"</font>"}function setId(id,rowIndex){return'<font style="color:#656565; font-size:0.9em">'+id+"</font>"}function poneEstado(estado,rowIndex){return 1==estado?'<font style="color:#656565; font-size:0.9em">PENDIENTE</font>':2==estado?'<font style="color:#656565; font-size:0.9em">INSCRITA</font>':'<font style="color:#656565; font-size:0.9em">NO INSCRITA</font>'}function poneFont(entry,rowIndex){return entry?"MUY INTERESADO"==entry?'<div align="center" style="width:16px; height:16px; background-color:green; border: 2px solid; border-radius: 10px; margin-left:7px;"></div>':"MEDIANAMENTE INTERESADO"==entry?'<div align="center" style="width:16px; height:16px; background-color:yellow; border: 2px solid; border-radius: 10px; margin-left:7px;"></div>':"POCO INTERES O ABANDONADO"==entry?'<div align="center" style="width:16px; height:16px; background-color:red; border: 2px solid; border-radius: 10px; margin-left:7px;"></div>':"blue"==entry?'<div align="center" style="width:16px; height:16px; background-color:#7BB0D6; border: 2px solid; border-radius: 10px; margin-left:7px;"></div>':'<span id="seguimiento"> </span>':'<span id="seguimiento"> </span>'}function poneFase(entry,rowIndex){switch(entry){case"1":entry="1.INICIO";break;case"2":entry="2.DEJË MENSAJE TELEFONICO";break;case"3":entry="3.VOLVER A LLAMAR";break;case"4":entry="4.POSPONEN EN VIAJE";break;case"5":entry="5.ENVIË DATOS Y DOCUMENTOS DE INSCRIPCION";break;case"6":entry="6.VISITË A CLIENTE";break;case"7":entry="7.CONCRETË CITA EN LA OFICINA";break;case"8":entry="8.LES ATENDÍ EN LA OFICINA";break;case"9":entry="9.ENVIÉ REVISTA";break;case"10":entry="10.FIN"}return'<font style="color:#656565; font-size:0.9em">'+entry+"</font>"}function poneInteres(entry,rowIndex){switch(entry){case"1":entry="MUY INTERESADO";break;case"2":entry=" MEDIANAMENTE INTERESADO";break;case"3":entry="POCO INTERESADO"}return'<font style="color:#656565; font-size:0.9em">'+entry+"</font>"}for(var data={identifier:"id",items:[]},data_list=[{col1:"normal",col2:!0,col3:"But are not followed by two hexadecimal",col4:29.91},{col1:"important",col2:!1,col3:"Because a % sign always indicates",col4:9.33},{col1:"important",col2:!0,col3:"Signs can be selectively",col4:19.34}],rows=60,i=0,l=data_list.length;i<rows;i++)data.items.push(dojo.mixin({id:i+1},data_list[i%l]));new dojo.data.ItemFileWriteStore({data:data});grid=new dojox.grid.DataGrid({id:"grid",query:{agente:window.parent.nombreuseract.toUpperCase(),estado:document.getElementById("estado").value},store:window.parent.seguimientoStore,clientSort:!0,onRowClick:function(e){id=grid._getItemAttr(e.rowIndex,"id"),setTimeout(function(){window.parent.crearseguimiento(id)},500),grid.selection.deselectAll(),grid.selection.setSelected(e.rowIndex,!0)},structure:[{name:"  ",field:"Color",formatter:poneFont,width:"2.5em"},{name:"#",field:"numId",width:"10%",width:"2.5em",formatter:setId},{name:"Ingreso",field:"fechaingreso",width:"6.5em",formatter:setFecha},{name:"Medio",field:"agencia",formatter:poneAgencia,width:"15em"},{name:"Vendedor",field:"agente",width:"15em",formatter:setVendedor},{name:"Quincea&ntilde;era",field:"nombrequinceanera",width:"15em",formatter:cuadraNombre},{name:"Contacto",field:"nombrequienllama",width:"15em",formatter:setContacto},{name:"Ciudad",field:"nombreciudad",width:"7.5em",formatter:poneCiudad},{name:"Estado",field:"estado",width:"5.5em",formatter:poneEstado},{name:"Destino",field:"destino",width:"15em",formatter:poneDestino},{name:"Mes",field:"mesviaje_quinceanera",width:"2em",formatter:poneMes},{name:"Año",field:"anoviaje_quinceanera",width:"3em",formatter:poneSalida},{name:"Colegio",field:"colegio",width:"15em",formatter:poneSalida},{name:"Fase",field:"fase",width:"5.5em",formatter:poneFase},{name:"Interés",field:"interes",width:"5.5em",formatter:poneInteres}]},"gridDiv"),grid.startup(),dojo.connect(grid,"_onFetchComplete",function(items){dojo.byId("totalseg").innerHTML=grid.rowCount}),tamano=window.parent.tama-180,document.getElementById("grid").style.height=tamano+"px",dijit.byId("grid").resize(),dijit.byId("grid").update(),document.getElementById("rompeQuery").style.display=""}),require(["dojo/ready","dojo/store/Memory","dijit/form/ComboBox","dijit/form/ValidationTextBox","dijit/form/FilteringSelect"],function(ready,Memory,ComboBox,ValidationTextBox,FilteringSelect){ready(function(){medio=new dijit.form.FilteringSelect({id:"idagencia",name:"data[Agencia][Agencia]",placeHolder:"Medio",require:!1,store:new Memory({data:window.parent.agencia}),autoComplete:!0,style:"width: 220px;color:#F00;backgorund-color:#ECE3F9;font-family:Verdana, Geneva, sans-serif;",onChange:function(departamento){var filterObject={};filterObject.agenciaNombre=this.item.name,filterObject.estado=document.getElementById("estado").value,document.getElementById("rompeQuery").style.display="",grid.filter({agenciaNombre:this.item.name.toUpperCase(),estado:document.getElementById("estado").value},!0)},searchAttr:"name"},"AgenciaAgencia"),destino=new dijit.form.FilteringSelect({id:"iddestino",name:"data[Destino][Destino]",placeHolder:"Destino",require:!1,store:new Memory({data:window.parent.destino}),autoComplete:!0,style:"width: 220px;color:#F00;backgorund-color:#ECE3F9;font-family:Verdana, Geneva, sans-serif;",onChange:function(departamento){var filterObject={};filterObject.destino="*"+this.item.id+"*",filterObject.estado=document.getElementById("estado").value,document.getElementById("rompeQuery").style.display="",grid.filter({destino:"*"+this.item.id+"*",estado:document.getElementById("estado").value},!0)},searchAttr:"name"},"destinoSeguimiento"),vendedor=new dijit.form.FilteringSelect({id:"idusers",name:"data[Seguimientos][User]",require:!1,placeHolder:"Vendedor",store:new Memory({data:window.parent.todos}),autoComplete:!0,style:"width: 220px;color:#F00;backgorund-color:#ECE3F9;font-family:Verdana, Geneva, sans-serif;",onChange:function(agente){document.getElementById("rompeQuery").style.display="",grid.filter({agente:this.item.id,estado:document.getElementById("estado").value},!0)},searchAttr:"nombre"},"VendedorVendedor"),dijit.byId("idagencia").required=!1,dijit.byId("idusers").required=!1,crearNotificaciones(),document.getElementById("totalseg").innerHTML=window.parent.seguimiento.length})}),window.parent.grabar=0,carga=window.parent.grabar,0==carga&&window.parent.cargaDatos();